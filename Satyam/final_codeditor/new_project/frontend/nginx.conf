server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # API Routes - Proxy to microservices
  location /api/execute {
    proxy_pass http://execution-service:8001/execute;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  location /api/run {
    proxy_pass http://execution-service:8001/run;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  location /api/problem/ {
    proxy_pass http://problem-service:8002/problem/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  location /api/problems {
    proxy_pass http://problem-service:8002/problems;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  location /api/submission {
    proxy_pass http://submission-service:8003/submission;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  location /api/submissions {
    proxy_pass http://submission-service:8003/submissions;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  location /api/draft {
    proxy_pass http://submission-service:8003/draft;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Frontend Routes - Serve React app
  location / {
    try_files $uri $uri/ /index.html;
  }
}
